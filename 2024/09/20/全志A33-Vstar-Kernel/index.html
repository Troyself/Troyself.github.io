<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>[全志A33-Vstar]Kernel | TroyMitchell's blog</title><meta name="author" content="TroyMitchell"><meta name="copyright" content="TroyMitchell"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文章基于该uboot启动：传送门 Envcpu: allwinner a33board: vstarhost: ubuntu 22.04 需要安装交叉编译工具链： ❯ sudo apt install gcc-arm-none-eabi  mainline首先下载主线kernel的源码： ❯ git clone git@github.com:torvalds&#x2F;linux.git  配置文件的话，">
<meta property="og:type" content="article">
<meta property="og:title" content="[全志A33-Vstar]Kernel">
<meta property="og:url" content="https://blog.troy-y.org/2024/09/20/%E5%85%A8%E5%BF%97A33-Vstar-Kernel/index.html">
<meta property="og:site_name" content="TroyMitchell&#39;s blog">
<meta property="og:description" content="本文章基于该uboot启动：传送门 Envcpu: allwinner a33board: vstarhost: ubuntu 22.04 需要安装交叉编译工具链： ❯ sudo apt install gcc-arm-none-eabi  mainline首先下载主线kernel的源码： ❯ git clone git@github.com:torvalds&#x2F;linux.git  配置文件的话，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/133468432?v=4">
<meta property="article:published_time" content="2024-09-20T14:49:02.000Z">
<meta property="article:modified_time" content="2024-09-20T16:15:42.000Z">
<meta property="article:author" content="TroyMitchell">
<meta property="article:tag" content="kernel">
<meta property="article:tag" content="a33">
<meta property="article:tag" content="allwinner">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://avatars.githubusercontent.com/u/133468432?v=4"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[全志A33-Vstar]Kernel",
  "url": "https://blog.troy-y.org/2024/09/20/%E5%85%A8%E5%BF%97A33-Vstar-Kernel/",
  "image": "https://avatars.githubusercontent.com/u/133468432?v=4",
  "datePublished": "2024-09-20T14:49:02.000Z",
  "dateModified": "2024-09-20T16:15:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "TroyMitchell",
      "url": "https://blog.troy-y.org"
    }
  ]
}</script><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/133468432?v=4"><link rel="canonical" href="https://blog.troy-y.org/2024/09/20/%E5%85%A8%E5%BF%97A33-Vstar-Kernel/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.4.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '[全志A33-Vstar]Kernel',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://avatars.githubusercontent.com/u/133468432?v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/top_img.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">TroyMitchell's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">[全志A33-Vstar]Kernel</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">[全志A33-Vstar]Kernel</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-20T14:49:02.000Z" title="发表于 2024-09-20 22:49:02">2024-09-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-20T16:15:42.000Z" title="更新于 2024-09-21 00:15:42">2024-09-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><strong>本文章基于该uboot启动</strong>：<a href="https://blog.troy-y.org/2024/09/13/%E5%85%A8%E5%BF%97A33-Uboot/">传送门</a></p>
<h2 id="Env"><a href="#Env" class="headerlink" title="Env"></a>Env</h2><p>cpu: allwinner a33<br>board: vstar<br>host: ubuntu 22.04</p>
<p>需要安装交叉编译工具链：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">❯ <span class="built_in">sudo</span> apt install gcc-arm-none-eabi</span><br></pre></td></tr></table></figure>

<h2 id="mainline"><a href="#mainline" class="headerlink" title="mainline"></a>mainline</h2><p>首先下载主线kernel的源码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">❯ git <span class="built_in">clone</span> git@github.com:torvalds/linux.git</span><br></pre></td></tr></table></figure>

<p>配置文件的话，在<code>arch/arm/configs</code>目录下只有一个<code>sunxi_defconfig</code>是我们能够使用的，那么就使用这个配置文件作为基准。</p>
<p>设备树就选择sinlinx的，与vstar开发板相近。</p>
<p>与uboot套路类似，先拷贝一份配置文件和设备树作为vstar开发板的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">❯ <span class="built_in">cp</span> <span class="built_in">arch</span>/arm/configs/sunxi_defconfig <span class="built_in">arch</span>/arm/configs/a33_vstar_defconfig</span><br><span class="line">❯ <span class="built_in">cp</span> <span class="built_in">arch</span>/arm/boot/dts/allwinner/sun8i-a33-sinlinx-sina33.dts <span class="built_in">arch</span>/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br></pre></td></tr></table></figure>

<p>修改Makefile支持该设备树：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">diff --git a/arch/arm/boot/dts/allwinner/Makefile b/arch/arm/boot/dts/allwinner/Makefile</span><br><span class="line">index cd0d044882cf..d548f4a2621a 100644</span><br><span class="line">--- a/arch/arm/boot/dts/allwinner/Makefile</span><br><span class="line">+++ b/arch/arm/boot/dts/allwinner/Makefile</span><br><span class="line">@@ -215,6 +215,7 @@ dtb-$(CONFIG_MACH_SUN8I) += \</span><br><span class="line">        sun8i-a33-olinuxino.dtb \</span><br><span class="line">        sun8i-a33-q8-tablet.dtb \</span><br><span class="line">        sun8i-a33-sinlinx-sina33.dtb \</span><br><span class="line">+       sun8i-a33-vstar.dtb \</span><br><span class="line">        sun8i-a83t-allwinner-h8homlet-v2.dtb \</span><br><span class="line">        sun8i-a83t-bananapi-m3.dtb \</span><br><span class="line">        sun8i-a83t-cubietruck-plus.dtb \</span><br></pre></td></tr></table></figure>

<p>使用刚才拷贝的配置文件进行编译：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">❯ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- a33_vstar_defconfig</span><br><span class="line">❯ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br></pre></td></tr></table></figure>

<p>可以看到镜像文件和设备树都已经生成：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">❯ <span class="built_in">ls</span> <span class="built_in">arch</span>/arm/boot/zImage</span><br><span class="line"><span class="built_in">arch</span>/arm/boot/zImage</span><br><span class="line">❯ <span class="built_in">ls</span> <span class="built_in">arch</span>/arm/boot/dts/allwinner/sun8i-a33-vstar.dtb</span><br><span class="line"><span class="built_in">arch</span>/arm/boot/dts/allwinner/sun8i-a33-vstar.dtb</span><br></pre></td></tr></table></figure>

<p>使用<a href="https://blog.troy-y.org/2024/09/20/sd%E4%B8%8Emmc%E5%88%B7%E5%86%99%E6%8C%87%E5%8D%97/">这篇文章</a>的技巧将kernel和dtb装入sd卡boot分区，装入emmc的boot分区也是可以的。</p>
<p><strong>PS：其实这里使用tftp更加合理，但在家中没有网口环境，所以只能退而求其次这样调试了。</strong></p>
<p>在uboot中执行如下命令查看boot分区：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; fatls mmc 0:1</span><br><span class="line">    65536   uboot.env</span><br><span class="line">    23345   sun8i-a33-vstar.dtb</span><br><span class="line">  5496008   zImage</span><br><span class="line"></span><br><span class="line">3 file(s), 0 <span class="built_in">dir</span>(s)</span><br></pre></td></tr></table></figure>

<p>现在文件已经装好了，就差装载地址了，在uboot中查看kernel的加载地址和dtb的加载地址：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; <span class="built_in">printenv</span> kernel_addr_r </span><br><span class="line">kernel_addr_r=0x42000000</span><br><span class="line">=&gt; <span class="built_in">printenv</span> fdt_addr_r </span><br><span class="line">fdt_addr_r=0x43000000</span><br></pre></td></tr></table></figure>

<p>可以确定内核的加载地址是<code>0x42000000</code>，设备树的加载地址是<code>0x43000000</code>.</p>
<p>使用load命令加载：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; load mmc 0:1 0x42000000 zImage</span><br><span class="line">5496008 bytes <span class="built_in">read</span> <span class="keyword">in</span> 229 ms (22.9 MiB/s)</span><br><span class="line">=&gt; load mmc 0:1 0x43000000 sun8i-a33-vstar.dtb</span><br><span class="line">23345 bytes <span class="built_in">read</span> <span class="keyword">in</span> 3 ms (7.4 MiB/s)</span><br></pre></td></tr></table></figure>

<p>由于内核镜像是经过压缩的，所以这里使用<code>bootz</code>命令进行启动：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; bootz 0x42000000 - 0x43000000</span><br><span class="line">Kernel image @ 0x42000000 [ 0x000000 - 0x53dcc8 ]</span><br><span class="line"><span class="comment">## Flattened Device Tree blob at 43000000</span></span><br><span class="line">   Booting using the fdt blob at 0x43000000</span><br><span class="line">Working FDT <span class="built_in">set</span> to 43000000</span><br><span class="line">   Loading Device Tree to 49ff7000, end 49fffb30 ... OK</span><br><span class="line">Working FDT <span class="built_in">set</span> to 49ff7000</span><br><span class="line"></span><br><span class="line">Starting kernel ...</span><br><span class="line"></span><br><span class="line">cyclic <span class="keyword">function</span> video_init took too long: 27000us vs 5000us max</span><br><span class="line">[    0.000000] Booting Linux on physical CPU 0x0</span><br><span class="line">[    0.000000] Linux version 6.11.0-rc6-00309-gd2742e387fe4 (troy@troy-WUJIE14-PRO) (arm-linux-gnueabihf-gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, GNU ld (GNU Bin</span><br><span class="line">utils <span class="keyword">for</span> Ubuntu) 2.38) <span class="comment">#4 SMP Fri Sep 20 22:58:32 CST 2024</span></span><br><span class="line">[    0.000000] CPU: ARMv7 Processor [410fc075] revision 5 (ARMv7), cr=10c5387d</span><br><span class="line">[    0.000000] CPU: div instructions available: patching division code</span><br><span class="line">[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache</span><br><span class="line">[    0.000000] OF: fdt: Machine model: Sinlinx SinA33</span><br><span class="line">[    0.000000] Memory policy: Data cache writealloc</span><br><span class="line">[    0.000000] cma: Reserved 16 MiB at 0x5d000000 on node -1</span><br><span class="line">[    0.000000] Zone ranges:</span><br><span class="line">[    0.000000]   Normal   [mem 0x0000000040000000-0x000000005dffffff]</span><br><span class="line">[    0.000000]   HighMem  empty</span><br><span class="line">[    0.000000] Movable zone start <span class="keyword">for</span> each node</span><br><span class="line">[    0.000000] Early memory node ranges</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000040000000-0x000000005dffffff]</span><br><span class="line">[    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x000000005dffffff]</span><br><span class="line">[    0.000000] psci: probing <span class="keyword">for</span> conduit method from DT.</span><br><span class="line">[    0.000000] psci: Using PSCI v0.1 Function IDs from DT</span><br><span class="line">[    0.000000] percpu: Embedded 13 pages/cpu s20876 r8192 d24180 u53248</span><br><span class="line">[    0.000000] Kernel <span class="built_in">command</span> line: </span><br><span class="line">[    0.000000] Dentry cache <span class="built_in">hash</span> table entries: 65536 (order: 6, 262144 bytes, linear)</span><br><span class="line">[    0.000000] Inode-cache <span class="built_in">hash</span> table entries: 32768 (order: 5, 131072 bytes, linear)</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 122880</span><br><span class="line">[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off</span><br><span class="line">[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1</span><br><span class="line">[    0.000000] rcu: Hierarchical RCU implementation.</span><br><span class="line">[    0.000000] rcu:     RCU restricting CPUs from NR_CPUS=8 to nr_cpu_ids=4.</span><br><span class="line">[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 10 jiffies.</span><br><span class="line">[    0.000000] rcu: Adjusting geometry <span class="keyword">for</span> rcu_fanout_leaf=16, nr_cpu_ids=4</span><br><span class="line">[    0.000000] NR_IRQS: 16, nr_irqs: 16, preallocated irqs: 16</span><br><span class="line">[    0.000000] GIC: Using <span class="built_in">split</span> EOI/Deactivate mode</span><br><span class="line">[    0.000000] rcu: srcu_init: Setting srcu_struct sizes based on contention.</span><br><span class="line">[    0.000000] arch_timer: cp15 timer(s) running at 24.00MHz (phys).</span><br><span class="line">[    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x588fe9dc0, max_idle_ns: 440795202592 ns</span><br><span class="line">[    0.000002] sched_clock: 56 bits at 24MHz, resolution 41ns, wraps every 4398046511097ns</span><br><span class="line">[    0.000018] Switching to timer-based delay loop, resolution 41ns</span><br><span class="line">[    0.000214] clocksource: timer: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 79635851949 ns</span><br><span class="line">[    0.000716] Console: colour dummy device 80x30</span><br><span class="line">[    0.000737] printk: legacy console [tty0] enabled</span><br><span class="line">[    0.001150] Calibrating delay loop (skipped), value calculated using timer frequency.. 48.00 BogoMIPS (lpj=240000)</span><br><span class="line">[    0.001186] CPU: Testing write buffer coherency: ok</span><br><span class="line">[    0.001256] pid_max: default: 32768 minimum: 301</span><br><span class="line">[    0.001462] Mount-cache <span class="built_in">hash</span> table entries: 1024 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.001501] Mountpoint-cache <span class="built_in">hash</span> table entries: 1024 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.002532] /cpus/cpu@0 missing clock-frequency property</span><br><span class="line">[    0.002602] /cpus/cpu@1 missing clock-frequency property</span><br><span class="line">[    0.002636] /cpus/cpu@2 missing clock-frequency property</span><br><span class="line">[    0.002669] /cpus/cpu@3 missing clock-frequency property</span><br><span class="line">[    0.002694] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000</span><br><span class="line">[    0.003911] Setting up static identity map <span class="keyword">for</span> 0x40100000 - 0x40100060</span><br><span class="line">[    0.004138] rcu: Hierarchical SRCU implementation.</span><br><span class="line">[    0.004168] rcu:     Max phase no-delay instances is 1000.</span><br><span class="line">[    0.004475] Timer migration: 1 hierarchy levels; 8 children per group; 1 crossnode level</span><br><span class="line">[    0.005197] smp: Bringing up secondary CPUs ...</span><br><span class="line">[    0.006381] CPU1: thread -1, cpu 1, socket 0, mpidr 80000001</span><br><span class="line">[    0.007615] CPU2: thread -1, cpu 2, socket 0, mpidr 80000002</span><br><span class="line">[    0.008778] CPU3: thread -1, cpu 3, socket 0, mpidr 80000003</span><br><span class="line">[    0.008903] smp: Brought up 1 node, 4 CPUs</span><br><span class="line">[    0.008972] SMP: Total of 4 processors activated (192.00 BogoMIPS).</span><br><span class="line">[    0.008993] CPU: All CPU(s) started <span class="keyword">in</span> HYP mode.</span><br><span class="line">[    0.009008] CPU: Virtualization extensions available.</span><br><span class="line">[    0.009739] Memory: 455244K/491520K available (8192K kernel code, 954K rwdata, 2404K rodata, 1024K init, 261K bss, 18116K reserved, 16384K cma-reserved, 0K high</span><br><span class="line">mem)</span><br><span class="line">[    0.010473] devtmpfs: initialized</span><br><span class="line">[    0.016216] VFP support v0.3: implementor 41 architecture 2 part 30 variant 7 rev 5</span><br><span class="line">[    0.016523] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns</span><br><span class="line">[    0.016574] futex <span class="built_in">hash</span> table entries: 1024 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.017387] pinctrl core: initialized pinctrl subsystem</span><br><span class="line">[    0.019573] NET: Registered PF_NETLINK/PF_ROUTE protocol family</span><br><span class="line">[    0.020760] DMA: preallocated 256 KiB pool <span class="keyword">for</span> atomic coherent allocations</span><br><span class="line">[    0.021844] thermal_sys: Registered thermal governor <span class="string">&#x27;step_wise&#x27;</span></span><br><span class="line">[    0.022011] hw-breakpoint: found 5 (+1 reserved) breakpoint and 4 watchpoint registers.</span><br><span class="line">[    0.022063] hw-breakpoint: maximum watchpoint size is 8 bytes.</span><br><span class="line">[    0.026636] platform 1c0c000.lcd-controller: Fixed dependency cycle(s) with /soc/drc@1e70000</span><br><span class="line">[    0.029751] platform 1e00000.display-frontend: Fixed dependency cycle(s) with /soc/display-backend@1e60000</span><br><span class="line">[    0.030124] platform 1e00000.display-frontend: Fixed dependency cycle(s) with /soc/display-backend@1e60000</span><br><span class="line">[    0.030236] platform 1e60000.display-backend: Fixed dependency cycle(s) with /soc/drc@1e70000</span><br><span class="line">[    0.030272] platform 1e60000.display-backend: Fixed dependency cycle(s) with /soc/display-frontend@1e00000</span><br><span class="line">[    0.030575] platform 1e60000.display-backend: Fixed dependency cycle(s) with /soc/drc@1e70000</span><br><span class="line">[    0.030674] platform 1c0c000.lcd-controller: Fixed dependency cycle(s) with /soc/drc@1e70000</span><br><span class="line">[    0.030773] platform 1e70000.drc: Fixed dependency cycle(s) with /soc/lcd-controller@1c0c000</span><br><span class="line">[    0.030874] platform 1e70000.drc: Fixed dependency cycle(s) with /soc/display-backend@1e60000</span><br><span class="line">[    0.033511] platform 1c0c000.lcd-controller: Fixed dependency cycle(s) with /panel</span><br><span class="line">[    0.033627] platform panel: Fixed dependency cycle(s) with /soc/lcd-controller@1c0c000</span><br><span class="line">[    0.037105] SCSI subsystem initialized</span><br><span class="line">[    0.037662] usbcore: registered new interface driver usbfs</span><br><span class="line">[    0.037724] usbcore: registered new interface driver hub</span><br><span class="line">[    0.037801] usbcore: registered new device driver usb</span><br><span class="line">[    0.038063] mc: Linux media interface: v0.10</span><br><span class="line">[    0.038129] videodev: Linux video capture interface: v2.00</span><br><span class="line">[    0.038229] pps_core: LinuxPPS API ver. 1 registered</span><br><span class="line">[    0.038250] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;</span><br><span class="line">[    0.038287] PTP clock support registered</span><br><span class="line">[    0.038843] Advanced Linux Sound Architecture Driver Initialized.</span><br><span class="line">[    0.040004] clocksource: Switched to clocksource arch_sys_counter</span><br><span class="line">[    0.049575] NET: Registered PF_INET protocol family</span><br><span class="line">[    0.049898] IP idents <span class="built_in">hash</span> table entries: 8192 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.051275] tcp_listen_portaddr_hash <span class="built_in">hash</span> table entries: 512 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.051335] Table-perturb <span class="built_in">hash</span> table entries: 65536 (order: 6, 262144 bytes, linear)</span><br><span class="line">[    0.051366] TCP established <span class="built_in">hash</span> table entries: 4096 (order: 2, 16384 bytes, linear)</span><br><span class="line">[    0.051427] TCP <span class="built_in">bind</span> <span class="built_in">hash</span> table entries: 4096 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.051643] TCP: Hash tables configured (established 4096 <span class="built_in">bind</span> 4096)</span><br><span class="line">[    0.051791] UDP <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.051856] UDP-Lite <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.052082] NET: Registered PF_UNIX/PF_LOCAL protocol family</span><br><span class="line">[    0.052808] RPC: Registered named UNIX socket transport module.</span><br><span class="line">[    0.052855] RPC: Registered udp transport module.</span><br><span class="line">[    0.052873] RPC: Registered tcp transport module.</span><br><span class="line">[    0.052888] RPC: Registered tcp-with-tls transport module.</span><br><span class="line">[    0.052904] RPC: Registered tcp NFSv4.1 backchannel transport module.</span><br><span class="line">[    0.054149] workingset: timestamp_bits=30 max_order=17 bucket_order=0</span><br><span class="line">[    0.055164] NFS: Registering the id_resolver key <span class="built_in">type</span></span><br><span class="line">[    0.055249] Key <span class="built_in">type</span> id_resolver registered</span><br><span class="line">[    0.055269] Key <span class="built_in">type</span> id_legacy registered</span><br><span class="line">[    0.055406] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 246)</span><br><span class="line">[    0.055436] io scheduler mq-deadline registered</span><br><span class="line">[    0.055455] io scheduler kyber registered</span><br><span class="line">[    0.055487] io scheduler bfq registered</span><br><span class="line">[    0.123068] Serial: 8250/16550 driver, 8 ports, IRQ sharing disabled</span><br><span class="line">[    0.132571] panel-simple panel: Specify missing connector_type</span><br><span class="line">[    0.140190] lima 1c40000.gpu: gp - mali400 version major 1 minor 1</span><br><span class="line">[    0.140335] lima 1c40000.gpu: pp0 - mali400 version major 1 minor 1</span><br><span class="line">[    0.140452] lima 1c40000.gpu: pp1 - mali400 version major 1 minor 1</span><br><span class="line">[    0.140513] lima 1c40000.gpu: l2_cache0 64K, 4-way, 64byte cache line, 64bit external bus</span><br><span class="line">[    0.140619] lima 1c40000.gpu: bus rate = 200000000</span><br><span class="line">[    0.140646] lima 1c40000.gpu: mod rate = 384000000</span><br><span class="line">[    0.140761] lima 1c40000.gpu: error -ENODEV: _opp_set_regulators: no regulator (mali) found</span><br><span class="line">[    0.141326] lima 1c40000.gpu: Failed to register cooling device</span><br><span class="line">[    0.141920] [drm] Initialized lima 1.1.0 <span class="keyword">for</span> 1c40000.gpu on minor 0</span><br><span class="line">[    0.146975] CAN device driver interface</span><br><span class="line">[    0.150247] sun6i-rtc 1f00000.rtc: registered as rtc0</span><br><span class="line">[    0.150323] sun6i-rtc 1f00000.rtc: setting system clock to 1970-01-01T00:43:53 UTC (2633)</span><br><span class="line">[    0.150930] i2c_dev: i2c /dev entries driver</span><br><span class="line">[    0.153101] sunxi-wdt 1c20ca0.watchdog: Watchdog enabled (<span class="built_in">timeout</span>=16 sec, nowayout=0)</span><br><span class="line">[    0.154435] sun4i-ss 1c15000.crypto-engine: Die ID 5</span><br><span class="line">[    0.155623] usbcore: registered new interface driver usbhid</span><br><span class="line">[    0.155654] usbhid: USB HID core driver</span><br><span class="line">[    0.161519] cedrus 1c0e000.video-codec: Device registered as /dev/video0</span><br><span class="line">[    0.165699] NET: Registered PF_PACKET protocol family</span><br><span class="line">[    0.165755] can: controller area network core</span><br><span class="line">[    0.165827] NET: Registered PF_CAN protocol family</span><br><span class="line">[    0.165851] can: raw protocol</span><br><span class="line">[    0.165869] can: broadcast manager protocol</span><br><span class="line">[    0.165891] can: netlink gateway - max_hops=1</span><br><span class="line">[    0.166091] Key <span class="built_in">type</span> dns_resolver registered</span><br><span class="line">[    0.166263] Registering SWP/SWPB emulation handler</span><br><span class="line">[    0.188378] gpio gpiochip0: Static allocation of GPIO base is deprecated, use dynamic allocation.</span><br><span class="line">[    0.190314] sun8i-a23-r-pinctrl 1f02c00.pinctrl: initialized sunXi PIO driver</span><br><span class="line">[    0.191090] gpio gpiochip1: Static allocation of GPIO base is deprecated, use dynamic allocation.</span><br><span class="line">[    0.193964] sun8i-a33-pinctrl 1c20800.pinctrl: initialized sunXi PIO driver</span><br><span class="line">[    0.194633] sun8i-a33-pinctrl 1c20800.pinctrl: supply vcc-pb not found, using dummy regulator</span><br><span class="line">[    0.216310] 1c28000.serial: ttyS0 at MMIO 0x1c28000 (irq = 140, base_baud = 1500000) is a U6_16550A</span><br><span class="line">[    0.216423] printk: legacy console [ttyS0] enabled</span><br><span class="line">[    1.162066] sun8i-a33-pinctrl 1c20800.pinctrl: supply vcc-pd not found, using dummy regulator</span><br><span class="line">[    1.171186] sun4i-drm display-engine: bound 1e00000.display-frontend (ops 0xc095450c)</span><br><span class="line">[    1.179400] sun4i-drm display-engine: bound 1e60000.display-backend (ops 0xc0953c78)</span><br><span class="line">[    1.187285] sun4i-drm display-engine: bound 1e70000.drc (ops 0xc09537a8)</span><br><span class="line">[    1.194715] sun4i-drm display-engine: bound 1c0c000.lcd-controller (ops 0xc0952418)</span><br><span class="line">[    1.203810] [drm] Initialized sun4i-drm 1.0.0 <span class="keyword">for</span> display-engine on minor 1</span><br><span class="line">[    1.212105] usb_phy_generic usb_phy_generic.1.auto: dummy supplies not allowed <span class="keyword">for</span> exclusive requests (<span class="built_in">id</span>=vbus)</span><br><span class="line">[    1.225635] ehci-platform 1c1a000.usb: EHCI Host Controller</span><br><span class="line">[    1.231359] ehci-platform 1c1a000.usb: new USB bus registered, assigned bus number 1</span><br><span class="line">[    1.232634] sun8i-a23-r-pinctrl 1f02c00.pinctrl: supply vcc-pl not found, using dummy regulator</span><br><span class="line">[    1.232655] ohci-platform 1c1a400.usb: Generic Platform OHCI controller</span><br><span class="line">[    1.232680] ohci-platform 1c1a400.usb: new USB bus registered, assigned bus number 2</span><br><span class="line">[    1.262744] sunxi-rsb 1f03400.rsb: RSB running at 3000000 Hz</span><br><span class="line">[    1.268854] axp20x-rsb sunxi-rsb-3a3: AXP20x variant AXP223 found</span><br><span class="line">[    1.269008] ohci-platform 1c1a400.usb: irq 144, io mem 0x01c1a400</span><br><span class="line">[    1.278800] input: axp20x-pek as /devices/platform/soc/1f03400.rsb/sunxi-rsb-3a3/axp221-pek/input/input0</span><br><span class="line">[    1.291724] axp20x-adc axp22x-adc: DMA mask not <span class="built_in">set</span></span><br><span class="line">[    1.297302] ehci-platform 1c1a000.usb: irq 143, io mem 0x01c1a000</span><br><span class="line">[    1.297733] axp20x-battery-power-supply axp20x-battery-power-supply: DMA mask not <span class="built_in">set</span></span><br><span class="line">[    1.312539] axp20x-ac-power-supply axp20x-ac-power-supply: DMA mask not <span class="built_in">set</span></span><br><span class="line">[    1.324341] axp20x-rsb sunxi-rsb-3a3: AXP20X driver loaded</span><br><span class="line">[    1.330230] ehci-platform 1c1a000.usb: USB 2.0 started, EHCI 1.00</span><br><span class="line">[    1.332049] input: 1c22800.lradc as /devices/platform/soc/1c22800.lradc/input/input1</span><br><span class="line">[    1.337352] hub 1-0:1.0: USB hub found</span><br><span class="line">[    1.348018] hub 1-0:1.0: 1 port detected</span><br><span class="line">[    1.358445] sun8i-a33-pinctrl 1c20800.pinctrl: supply vcc-pf not found, using dummy regulator</span><br><span class="line">[    1.358514] clk: Disabling unused clocks</span><br><span class="line">[    1.358756] hub 2-0:1.0: USB hub found</span><br><span class="line">[    1.358820] hub 2-0:1.0: 1 port detected</span><br><span class="line">[    1.358836] sun8i-a33-pinctrl 1c20800.pinctrl: supply vcc-pc not found, using dummy regulator</span><br><span class="line">[    1.387380] ALSA device list:</span><br><span class="line">[    1.390398]   No soundcards found.</span><br><span class="line">[    1.394999] sunxi-mmc 1c0f000.mmc: Got CD GPIO</span><br><span class="line">[    1.419939] sunxi-mmc 1c11000.mmc: initialized, max. request size: 16384 KB</span><br><span class="line">[    1.423106] sunxi-mmc 1c0f000.mmc: initialized, max. request size: 16384 KB</span><br><span class="line">[    1.434628] /dev/root: Can<span class="string">&#x27;t open blockdev</span></span><br><span class="line"><span class="string">[    1.438774] VFS: Cannot open root device &quot;&quot; or unknown-block(0,0): error -6</span></span><br><span class="line"><span class="string">[    1.445782] Please append a correct &quot;root=&quot; boot option; here are the available partitions:</span></span><br><span class="line"><span class="string">[    1.454156] List of all bdev filesystems:</span></span><br><span class="line"><span class="string">[    1.458168]  ext3</span></span><br><span class="line"><span class="string">[    1.458174]  ext2</span></span><br><span class="line"><span class="string">[    1.460115]  ext4</span></span><br><span class="line"><span class="string">[    1.462045]  vfat</span></span><br><span class="line"><span class="string">[    1.463974] </span></span><br><span class="line"><span class="string">[    1.467258] mmc1: host does not support reading read-only switch, assuming write-enable</span></span><br><span class="line"><span class="string">[    1.467391] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</span></span><br><span class="line"><span class="string">[    1.467401] CPU: 3 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.11.0-rc6-00309-gd2742e387fe4 #4</span></span><br><span class="line"><span class="string">[    1.467411] Hardware name: Allwinner sun8i Family</span></span><br><span class="line"><span class="string">[    1.467416] Call trace: </span></span><br><span class="line"><span class="string">[    1.467430]  unwind_backtrace from show_stack+0x10/0x14</span></span><br><span class="line"><span class="string">[    1.467465]  show_stack from dump_stack_lvl+0x50/0x64</span></span><br><span class="line"><span class="string">[    1.467484]  dump_stack_lvl from panic+0x10c/0x344</span></span><br><span class="line"><span class="string">[    1.467497]  panic from mount_root_generic+0x1d4/0x278</span></span><br><span class="line"><span class="string">[    1.467513]  mount_root_generic from prepare_namespace+0x1fc/0x258</span></span><br><span class="line"><span class="string">[    1.467527]  prepare_namespace from kernel_init+0x1c/0x12c</span></span><br><span class="line"><span class="string">[    1.467542]  kernel_init from ret_from_fork+0x14/0x28</span></span><br><span class="line"><span class="string">[    1.467554] Exception stack(0xde821fb0 to 0xde821ff8)</span></span><br><span class="line"><span class="string">[    1.467565] 1fa0:                                     00000000 00000000 00000000 00000000</span></span><br><span class="line"><span class="string">[    1.467574] 1fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000</span></span><br><span class="line"><span class="string">[    1.467582] 1fe0: 00000000 00000000 00000000 00000000 00000013 00000000</span></span><br><span class="line"><span class="string">[    1.564419] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0) ]---</span></span><br></pre></td></tr></table></figure>

<p>内核直接报了<code>panic</code>，经过定位，可以确定如下一条依据：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[    1.445782] Please append a correct <span class="string">&quot;root=&quot;</span> boot option; here are the available partitions:</span><br></pre></td></tr></table></figure>

<p>这里的意思就是我们没有指定根文件系统，那一定是bootargs出了问题，复位进入uboot，查看bootargs的参数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; <span class="built_in">printenv</span> bootargs</span><br><span class="line"><span class="comment">## Error: &quot;bootargs&quot; not defined</span></span><br></pre></td></tr></table></figure>

<p>居然没有这个环境变量，想到了armbian是有对a33进行支持的，我们可以去脱一下armbian的bootargs。</p>
<p>下载<a target="_blank" rel="noopener" href="https://github.com/armbian/community/releases/download/24.11.0-trunk.66/Armbian_community_24.11.0-trunk.66_Lime-a33_bookworm_current_6.6.44_minimal.img.xz">armbian</a>的镜像之后通过<code>balenaEtcher</code>工具刷入sd卡，进入系统后提取<code>boot</code>分区中的<code>boot.scr</code>。</p>
<p>该脚本中有这么一句话：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">setenv bootargs <span class="string">&quot;root=<span class="variable">$&#123;rootdev&#125;</span> rootwait rootfstype=<span class="variable">$&#123;rootfstype&#125;</span> <span class="variable">$&#123;consoleargs&#125;</span> hdmi.audio=EDID:0 disp.screen0_output_mode=<span class="variable">$&#123;disp_mode&#125;</span> consoleblank=0 loglevel=<span class="variable">$&#123;verbosity&#125;</span> ubootpart=<span class="variable">$&#123;partuuid&#125;</span> ubootsource=<span class="variable">$&#123;devtype&#125;</span> usb-storage.quirks=<span class="variable">$&#123;usbstoragequirks&#125;</span> <span class="variable">$&#123;extraargs&#125;</span> <span class="variable">$&#123;extraboardargs&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>在<code>armbian</code>的<code>uboot</code>中一句句对照env，并且删减一些无关项后得到如下<code>bootargs</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; setenv bootargs <span class="string">&#x27;earlycon earlyprintk root=/dev/mmcblk0p2 rootwait rw rootfstype=ext4 console=ttyS2,115200 consoleblank=0 loglevel=8&#x27;</span></span><br><span class="line">=&gt; <span class="built_in">printenv</span> bootargs </span><br><span class="line">bootargs=earlycon earlyprintk root=/dev/mmcblk0p2 rootwait rw rootfstype=ext4 console=ttyS2,115200 consoleblank=0 loglevel=8</span><br><span class="line">=&gt; saveenv</span><br><span class="line">Saving Environment to FAT... OK</span><br></pre></td></tr></table></figure>

<p>重新加载并且启动后发现log到Starting kernel就停止了：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=&gt; load mmc 0:1 0x42000000 zImage</span><br><span class="line">5496008 bytes <span class="built_in">read</span> <span class="keyword">in</span> 229 ms (22.9 MiB/s)</span><br><span class="line">=&gt; load mmc 0:1 0x43000000 sun8i-a33-vstar.dtb</span><br><span class="line">23345 bytes <span class="built_in">read</span> <span class="keyword">in</span> 2 ms (11.1 MiB/s)</span><br><span class="line">=&gt; bootz 0x42000000 - 0</span><br><span class="line">Kernel image @ 0x42000000 [ 0x000000 - 0x53dcc8 ]</span><br><span class="line">ERROR: Did not find a cmdline Flattened Device Tree</span><br><span class="line">Could not find a valid device tree</span><br><span class="line">=&gt; bootz 0x42000000 - 0x43000000</span><br><span class="line">Kernel image @ 0x42000000 [ 0x000000 - 0x53dcc8 ]</span><br><span class="line"><span class="comment">## Flattened Device Tree blob at 43000000</span></span><br><span class="line">   Booting using the fdt blob at 0x43000000</span><br><span class="line">Working FDT <span class="built_in">set</span> to 43000000</span><br><span class="line">   Loading Device Tree to 49ff7000, end 49fffb30 ... OK</span><br><span class="line">Working FDT <span class="built_in">set</span> to 49ff7000</span><br><span class="line"></span><br><span class="line">Starting kernel ...</span><br><span class="line"></span><br><span class="line">cyclic <span class="keyword">function</span> video_init took too long: 27000us vs 5000us max</span><br></pre></td></tr></table></figure>

<h3 id="修改串口"><a href="#修改串口" class="headerlink" title="修改串口"></a>修改串口</h3><p>这很容易判断，我们硬件电气连接的是uart2, 肯定是串口的问题了，查看设备树：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">❯ <span class="built_in">cat</span> <span class="built_in">arch</span>/arm/boot/dts/allwinner/sun8i-a33-vstar.dts | grep serial</span><br><span class="line">		serial0 = &amp;uart0;</span><br><span class="line">		stdout-path = <span class="string">&quot;serial0:115200n8&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>果然，设备树中是串口0,为了避免和sd卡引脚复用冲突（<strong>该部分在uboot已经说明过</strong>）, 将其修改成uart2,并且我们的bootargs中指定的也是uart2.</p>
<p>修改后的差异：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">diff --git a/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts b/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br><span class="line">index 0c82ff3c7cb4..7bb29d78c77f 100644</span><br><span class="line">--- a/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br><span class="line">+++ b/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br><span class="line">@@ -54,11 +54,11 @@ / &#123;</span><br><span class="line"> 	compatible = <span class="string">&quot;sinlinx,sina33&quot;</span>, <span class="string">&quot;allwinner,sun8i-a33&quot;</span>;</span><br><span class="line"> </span><br><span class="line"> 	aliases &#123;</span><br><span class="line">-		serial0 = &amp;uart0;</span><br><span class="line">+		serial2 = &amp;uart2;</span><br><span class="line"> 	&#125;;</span><br><span class="line"> </span><br><span class="line"> 	chosen &#123;</span><br><span class="line">-		stdout-path = <span class="string">&quot;serial0:115200n8&quot;</span>;</span><br><span class="line">+		stdout-path = <span class="string">&quot;serial2:115200n8&quot;</span>;</span><br><span class="line"> 	&#125;;</span><br><span class="line"> </span><br><span class="line"> 	panel &#123;</span><br><span class="line">@@ -261,6 +261,12 @@ tcon0_out_panel: endpoint@0 &#123;</span><br><span class="line"> &amp;uart0 &#123;</span><br><span class="line"> 	pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line"> 	pinctrl-0 = &lt;&amp;uart0_pb_pins&gt;;</span><br><span class="line">+	status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">+&#125;;</span><br><span class="line">+</span><br><span class="line">+&amp;uart2 &#123;</span><br><span class="line">+	pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">+	pinctrl-0 = &lt;&amp;uart2_pins&gt;;</span><br><span class="line"> 	status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line"> &#125;;</span><br><span class="line"> </span><br><span class="line">@@ -273,3 +279,10 @@ &amp;usbphy &#123;</span><br><span class="line"> 	status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line"> 	usb1_vbus-supply = &lt;&amp;reg_vcc5v0&gt;; /* USB1 VBUS is always on */</span><br><span class="line"> &#125;;</span><br><span class="line">+</span><br><span class="line">+&amp;pio &#123;</span><br><span class="line">+	uart2_pins: uart2-pins &#123;</span><br><span class="line">+		pins = <span class="string">&quot;PB0&quot;</span>, <span class="string">&quot;PB1&quot;</span>;</span><br><span class="line">+		<span class="keyword">function</span> = <span class="string">&quot;uart2&quot;</span>;</span><br><span class="line">+	&#125;;</span><br><span class="line">+&#125;;</span><br></pre></td></tr></table></figure>

<p>重新启动后可以正常看到输出了！</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[    1.242405] Waiting <span class="keyword">for</span> root device /dev/mmcblk0p2...</span><br><span class="line">[    1.278711] mmc1: host does not support reading read-only switch, assuming write-enable</span><br><span class="line">[    1.296810] mmc1: new high speed SDXC card at address 59b4</span><br><span class="line">[    1.307496] mmcblk1: mmc1:59b4 SD64G 59.4 GiB</span><br><span class="line">[    1.326969]  mmcblk1: p1 p2</span><br><span class="line">[    1.381752] mmc0: new DDR MMC card at address 0001</span><br><span class="line">[    1.387723] mmcblk0: mmc0:0001 004G60 3.69 GiB</span><br><span class="line">[    1.405833]  mmcblk0: p1 p2</span><br><span class="line">[    1.414082] mmcblk0boot0: mmc0:0001 004G60 2.00 MiB</span><br><span class="line">[    1.421045] mmcblk0boot1: mmc0:0001 004G60 2.00 MiB</span><br><span class="line">[    1.447615] usb 1-1: new high-speed USB device number 2 using ehci-platform</span><br><span class="line">[    1.462789] EXT4-fs (mmcblk0p2): recovery complete</span><br><span class="line">[    1.467843] EXT4-fs (mmcblk0p2): mounted filesystem 3cdb3fe9-0a84-41be-9519-ec406d029db6 r/w with ordered data mode. Quota mode: disabled.</span><br><span class="line">[    1.480404] VFS: Mounted root (ext4 filesystem) on device 179:10.</span><br><span class="line">[    1.487217] devtmpfs: error mounting -2</span><br><span class="line">[    1.496557] Freeing unused kernel image (initmem) memory: 1024K</span><br><span class="line">[    1.502730] Run /sbin/init as init process</span><br><span class="line">[    1.506831]   with arguments:</span><br><span class="line">[    1.509826]     /sbin/init</span><br><span class="line">[    1.512536]     earlyprintk</span><br><span class="line">[    1.515329]   with environment:</span><br><span class="line">[    1.518489]     HOME=/</span><br><span class="line">[    1.520938]     TERM=linux</span><br><span class="line">[    1.523983] Run /etc/init as init process</span><br><span class="line">[    1.528010]   with arguments:</span><br><span class="line">[    1.531062]     /etc/init</span><br><span class="line">[    1.533975]     earlyprintk</span><br><span class="line">[    1.536766]   with environment:</span><br><span class="line">[    1.539921]     HOME=/</span><br><span class="line">[    1.542366]     TERM=linux</span><br><span class="line">[    1.545366] Run /bin/init as init process</span><br><span class="line">[    1.549385]   with arguments:</span><br><span class="line">[    1.552349]     /bin/init</span><br><span class="line">[    1.554966]     earlyprintk</span><br><span class="line">[    1.557768]   with environment:</span><br><span class="line">[    1.560905]     HOME=/</span><br><span class="line">[    1.563261]     TERM=linux</span><br><span class="line">[    1.565979] Run /bin/sh as init process</span><br><span class="line">[    1.569826]   with arguments:</span><br><span class="line">[    1.572790]     /bin/sh</span><br><span class="line">[    1.575233]     earlyprintk</span><br><span class="line">[    1.578042]   with environment:</span><br><span class="line">[    1.581179]     HOME=/</span><br><span class="line">[    1.583537]     TERM=linux</span><br><span class="line">[    1.586247] Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/admin-guide/init.rst <span class="keyword">for</span> guidance.</span><br><span class="line">[    1.600399] CPU: 1 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.11.0-rc6-00309-gd2742e387fe4-dirty <span class="comment">#5</span></span><br><span class="line">[    1.609523] Hardware name: Allwinner sun8i Family</span><br><span class="line">[    1.614222] Call trace: </span><br><span class="line">[    1.614238]  unwind_backtrace from show_stack+0x10/0x14</span><br><span class="line">[    1.622013]  show_stack from dump_stack_lvl+0x50/0x64</span><br><span class="line">[    1.627074]  dump_stack_lvl from panic+0x10c/0x344</span><br><span class="line">[    1.631869]  panic from _cpu_down+0x0/0x6a0</span><br><span class="line">[    1.636155] ---[ end Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/admin-guide/init.rst <span class="keyword">for</span> gu</span><br><span class="line">idance. ]---</span><br></pre></td></tr></table></figure>

<h3 id="固定mmc序号"><a href="#固定mmc序号" class="headerlink" title="固定mmc序号"></a>固定mmc序号</h3><p>但这里还是出现了<code>pannic</code>，重点观察到如下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[    1.242405] Waiting <span class="keyword">for</span> root device /dev/mmcblk0p2...</span><br><span class="line">[    1.278711] mmc1: host does not support reading read-only switch, assuming write-enable</span><br><span class="line">[    1.296810] mmc1: new high speed SDXC card at address 59b4</span><br><span class="line">[    1.307496] mmcblk1: mmc1:59b4 SD64G 59.4 GiB</span><br></pre></td></tr></table></figure>

<p>这里说是等待mmcblk0设备但是sd卡确实mmc1, 并且我每次复位sd卡的序号都不一样，可能是mmc0也可能是mmc1, 这可不行，因为rootfs的分区是我们在bootargs里面定死了的，所以只能固定mmc序号。</p>
<p>修改设备树：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">diff --git a/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts b/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br><span class="line">index f89a005227d9..95a7c7f394b8 100644</span><br><span class="line">--- a/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br><span class="line">+++ b/arch/arm/boot/dts/allwinner/sun8i-a33-vstar.dts</span><br><span class="line">@@ -55,6 +55,10 @@ / &#123;</span><br><span class="line"> </span><br><span class="line">        aliases &#123;</span><br><span class="line">                serial2 = &amp;uart2;</span><br><span class="line">+               /* SD Card */</span><br><span class="line">+               mmc0 = &amp;mmc0;</span><br><span class="line">+               /* emmc */</span><br><span class="line">+               mmc1 = &amp;mmc2;</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        chosen &#123;</span><br></pre></td></tr></table></figure>

<h3 id="TODO-详细解释为何这样修改就可以固定序号"><a href="#TODO-详细解释为何这样修改就可以固定序号" class="headerlink" title="TODO : 详细解释为何这样修改就可以固定序号"></a>TODO : 详细解释为何这样修改就可以固定序号</h3><p>重新烧录可以看到无论重启多少次，mmc的序号都是固定不变的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[    1.244304] Waiting <span class="keyword">for</span> root device /dev/mmcblk0p2...</span><br><span class="line">[    1.284821] mmc0: host does not support reading read-only switch, assuming write-enable</span><br><span class="line">[    1.294664] mmc0: new high speed SDXC card at address 59b4</span><br><span class="line">[    1.307075] mmcblk0: mmc0:59b4 SD64G 59.4 GiB</span><br><span class="line">[    1.323511]  mmcblk0: p1 p2</span><br></pre></td></tr></table></figure>

<p>接下来就是紧急制作一个文件系统：<a href="https://blog.troy-y.org/2024/09/20/rootfs-%E5%88%B6%E4%BD%9CUbuntu%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">传送门</a></p>
<p>制作好根文件系统之后将根文件系统的内容放入rootfs分区，不知道怎么放可以参考这里：<a href="https://blog.troy-y.org/2024/09/20/sd%E4%B8%8Emmc%E5%88%B7%E5%86%99%E6%8C%87%E5%8D%97/">传送门</a></p>
<p>重新启动就已经可以进入根文件系统了：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Ubuntu 22.04 LTS a33-vstar ttyS2</span><br><span class="line"></span><br><span class="line">a33-vstar login: root</span><br><span class="line">Password: </span><br><span class="line">Welcome to Ubuntu 22.04 LTS (GNU/Linux 6.11.0-rc6-00311-g9be470523bd2-dirty armv7l)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line">Last login: Thu Apr  7 19:28:32 UTC 2022 on ttyS2</span><br><span class="line">root@a33-vstar:~# <span class="built_in">uname</span></span><br><span class="line">Linux</span><br><span class="line">root@a33-vstar:~# <span class="built_in">uname</span> -a</span><br><span class="line">Linux a33-vstar 6.11.0-rc6-00311-g9be470523bd2-dirty <span class="comment">#6 SMP Fri Sep 20 23:40:53 CST 2024 armv7l armv7l armv7l GNU/Linux</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.troy-y.org">TroyMitchell</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.troy-y.org/2024/09/20/%E5%85%A8%E5%BF%97A33-Vstar-Kernel/">https://blog.troy-y.org/2024/09/20/%E5%85%A8%E5%BF%97A33-Vstar-Kernel/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.troy-y.org" target="_blank">TroyMitchell's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/kernel/">kernel</a><a class="post-meta__tags" href="/tags/a33/">a33</a><a class="post-meta__tags" href="/tags/allwinner/">allwinner</a></div><div class="post-share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/133468432?v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/09/20/rootfs-%E5%88%B6%E4%BD%9CUbuntu%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="[rootfs]制作Ubuntu根文件系统"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">[rootfs]制作Ubuntu根文件系统</div></div><div class="info-2"><div class="info-item-1">Requirements  An x86_64 machine with Ubuntu or another Linux distribution installed. debootstrap tool. Internet connection. Basic knowledge of using the terminal.  Steps to Create Ubuntu 20.04 Rootfs for ARMhf 1. Install Required Tools First, ensure that debootstrap and qemu-user-static are installed. qemu-user-static allows you to run ARM binaries on your x86_64 machine. sudo apt updatesudo apt install debootstrap qemu-user-static  2. Create a Directory for the Rootfs Create a directory wher...</div></div></div></a><a class="pagination-related" href="/2024/09/13/Linux%E5%88%86%E5%8C%BA%E6%81%A2%E5%A4%8D/" title="Linux分区恢复"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Linux分区恢复</div></div><div class="info-2"><div class="info-item-1">在删除U盘分区的时候，忘了插U盘，直接把Ubuntu的efi分区删掉了。 直接原地红温… 不过还好删除的是分区不是数据，还有的救… 注意这时候千万不要重启系统！！！ 查看分区挂载： ❯ lsblkNAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS...nvme0n1     259:0    0 953.9G  0 disk └─nvme0n1p2 259:2    0 953.4G  0 part /  已经看不见p1了，但是！ 执行如下命令安装众神之父testdisk: ❯ sudo apt install testdisk   这个工具非常好用，可以自定义检测分区表，并且检测丢失的分区： ❯ sudo testdisk /dev/nvme0n1  进入如下界面, 这里是选择磁盘，我只有一个盘，所以就直接按enter了：  选择磁盘后需要选择你的磁盘分区表类型，Intel是自动选择，按道理应该是GPT分区，但是不太自信，所以选择了Intel进入：  这里显示检测到了GPT分区，直接按Enter进入：  在如下界面中直接选中Ana...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/08/22/OpenHarmony-on-rk3568%E4%BD%BF%E8%83%BDcan/" title="OpenHarmony on rk3568使能can"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-22</div><div class="info-item-2">OpenHarmony on rk3568使能can</div></div><div class="info-2"><div class="info-item-1">EnvOH: v3.2.3chip: rk3568 Content首先查看源码中是否具有CAN_ROCKCHIP选项： ❯ find -name &quot;Kconfig&quot; -exec grep -n &quot;CAN_ROCKCHIP&quot; &#123;&#125; +❯   发现什么都没有..好吧，那看到官方的rk3568的补丁并没有打到这里，需要自己进行适配。 去rockchip的kernel仓库找到关于can的部分：https://github.com/rockchip-linux/kernel/blob/develop-5.10/drivers/net/can/rockchip/ 进入到我们的内核工作目录，没有Makefile创建的可以见这篇文章：https://blog.troy-y.org/2024/08/16/rk3568%E7%A7%BB%E6%A4%8DopenHarmony-v3-2-3-%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/ 将刚才仓库的文件无论用什么方式放到driver/net/can/rockch...</div></div></div></a><a class="pagination-related" href="/2024/08/23/Rockchip-%E7%B3%BB%E5%88%97%E8%8A%AF%E7%89%87uboot-distro-cmd/" title="rk3568 uboot distro_cmd"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-23</div><div class="info-item-2">rk3568 uboot distro_cmd</div></div><div class="info-2"><div class="info-item-1">bootcmd在uboot的shell中使用printenv命令可以看到bootcmd的字符串： =&gt; printenv bootcmdbootcmd=boot_android $&#123;devtype&#125; $&#123;devnum&#125;;boot_fit;bootrkp;run distro_bootcmd;  命令解析：    - boot_android: 查找并尝试启动安卓镜像。    - boot_fix: 查找并尝试启动fit格式镜像。    - bootrkp: 查找并尝试启动rk分区镜像。    - run distro_bootcmd: 这就是这篇文章的主角了，distro_bootcmd可以根据不同介质去启动kernel内核，比如kernel可以在sd卡，emmc上，都可以顺利启动。 以上提到的bootcmd可以在include/configs/rockchip-common.h中看到相关定义： #if defined(CONFIG_AVB_VBMETA_PUBLIC_KEY_VALIDATE)#define RKIMG_BOOTCO...</div></div></div></a><a class="pagination-related" href="/2024/07/03/earlycon/" title="earlycon"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-03</div><div class="info-item-2">earlycon</div></div><div class="info-2"><div class="info-item-1">引言earlycon 是一个早期控制台（early console）机制，用于在系统启动的早期阶段提供输出功能。在内核启动过程的早期阶段，标准的控制台设备（如串口、VGA控制台等）可能还没有初始化完成，这时可以使用 earlycon 来输出调试信息，帮助开发者调试内核启动过程中的问题。 如何开启earlycon要在内核启动时启用 earlycon，需要在内核配置中启用几个相关的配置选项： CONFIG_SERIAL_EARLYCONCONFIG_OF_EARLY_FLATTREE  还需要在内核命令行参数中添加相关设置。例如： earlycon=pxa_serial,0xd4017000  具体流程在 Kernel 初始化汇编代码执行完跳转到 start_kernel 之后，setup_arch 调用 parse_early_param，进而在其中执行 early_param 的解析，具体如下： start_kernel-&gt;setup_arch-&gt;parse_early_param-&gt;parse_early_options-&gt;do_early_param ...</div></div></div></a><a class="pagination-related" href="/2024/07/17/i2c-adpater-mainline-for-k1-of-spacemit/" title="i2c-adpater-mainline for k1 of spacemit"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-17</div><div class="info-item-2">i2c-adpater-mainline for k1 of spacemit</div></div><div class="info-2"><div class="info-item-1">初步完善框架#include &lt;linux/mod_devicetable.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/platform_device.h&gt;#include &lt;linux/device.h&gt;#include &lt;linux/i2c.h&gt;#include &lt;linux/err.h&gt;#include &lt;linux/clk.h&gt;#include &quot;i2c-k1x.h&quot;static intspacemit_k1_i2c_xfer(struct i2c_adapter *adapt, struct i2c_msg msgs[], int num) &#123;	struct spacemit_k1_i2c *i2c = i2c_get_adapdata(adapt);	return num;&#125;static u32 spacemit_k1_i2c_functionality(struct i2c_adapter *adap)...</div></div></div></a><a class="pagination-related" href="/2025/01/04/linux%E6%8C%82%E8%BD%BDnfs%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%A4%B1%E8%B4%A5/" title="linux挂载nfs根文件系统失败"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="info-item-2">linux挂载nfs根文件系统失败</div></div><div class="info-2"><div class="info-item-1">挂在nfs根文件系统时出现如下报错： [    1.939157] VFS: Cannot open root device &quot;nfs&quot; or unknown-block(0,255): error -6[    1.946989] Please append a correct &quot;root=&quot; boot option; here are the available partitions:[    1.955765] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,255)[    1.964493] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,255) ]---  根据内核日志来看bootargs是设置正确的，经过多方排查是以下配置没开启： CONFIG_ROOT_NFS</div></div></div></a><a class="pagination-related" href="/2024/07/31/rk3568-sd-card%E6%97%A0%E6%B3%95%E6%A3%80%E6%B5%8B-1/" title="rk3568 sd card无法检测"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-31</div><div class="info-item-2">rk3568 sd card无法检测</div></div><div class="info-2"><div class="info-item-1">配置好设备树节点后插入sd卡无法检测。 设备树节点如下： &amp;sdmmc0 &#123;	bus-width = &lt;4&gt;;	cap-sd-highspeed;	cd-gpios = &lt;&amp;gpio0 RK_PA4 GPIO_ACTIVE_LOW&gt;;	disable-wp;	pinctrl-names = &quot;default&quot;;	pinctrl-0 = &lt;&amp;sdmmc0_bus4 &amp;sdmmc0_clk &amp;sdmmc0_cmd &amp;sdmmc0_det&gt;;	sd-uhs-sdr104;	vmmc-supply = &lt;&amp;vcc3v3_sd&gt;;	vqmmc-supply = &lt;&amp;vccio_sd&gt;;	status = &quot;okay&quot;;&#125;;  查看内核日志发现如下报错： dmesg | grep mmc[   12.226496] dwmmc_rockchip fe2b0000.mmc: Looking up vmmc-sup...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/133468432?v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TroyMitchell</div><div class="author-info-description">对弈平凡</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/TroyMitchell911"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Words are cheap, I do.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Env"><span class="toc-number">1.</span> <span class="toc-text">Env</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mainline"><span class="toc-number">2.</span> <span class="toc-text">mainline</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%B2%E5%8F%A3"><span class="toc-number">2.1.</span> <span class="toc-text">修改串口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9Ammc%E5%BA%8F%E5%8F%B7"><span class="toc-number">2.2.</span> <span class="toc-text">固定mmc序号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TODO-%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%B8%BA%E4%BD%95%E8%BF%99%E6%A0%B7%E4%BF%AE%E6%94%B9%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%9B%BA%E5%AE%9A%E5%BA%8F%E5%8F%B7"><span class="toc-number">2.3.</span> <span class="toc-text">TODO : 详细解释为何这样修改就可以固定序号</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/08/openmpi-3-btl-mca-self/" title="openmpi[3] btl框架的self组件分析">openmpi[3] btl框架的self组件分析</a><time datetime="2025-09-08T09:44:55.000Z" title="发表于 2025-09-08 17:44:55">2025-09-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/08/openmpi-2-modular-component-architecture/" title="openmpi[2] 模块化组件架构">openmpi[2] 模块化组件架构</a><time datetime="2025-09-08T07:49:21.000Z" title="发表于 2025-09-08 15:49:21">2025-09-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/04/openmpi-1-what-is-openmpi/" title="openmpi[1] 什么是openmpi">openmpi[1] 什么是openmpi</a><time datetime="2025-09-04T01:57:36.000Z" title="发表于 2025-09-04 09:57:36">2025-09-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/01/sd%E4%B8%8Emmc%E5%88%B7%E5%86%99%E6%8C%87%E5%8D%97/" title="sd与mmc刷写指南">sd与mmc刷写指南</a><time datetime="2025-08-01T07:25:00.169Z" title="发表于 2025-08-01 15:25:00">2025-08-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/01/VirtualBox%E9%94%99%E8%AF%AF-1/" title="VirtualBox错误">VirtualBox错误</a><time datetime="2025-08-01T07:25:00.168Z" title="发表于 2025-08-01 15:25:00">2025-08-01</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2025 By TroyMitchell</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.4.3"></script><script src="/js/main.js?v=5.4.3"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>